{{ define "main" }}
  {{ if .Sections }}
    <section class="books-grid">
      <h1 class="section-title">Books</h1>
      <div class="grid">
        {{ range $index, $book := .Sections.ByTitle }}
          {{ $gradients := slice 
            "linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
            "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"
            "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"
            "linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"
            "linear-gradient(135deg, #fa709a 0%, #fee140 100%)"
            "linear-gradient(135deg, #30cfd0 0%, #330867 100%)"
            "linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"
            "linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)"
          }}
          {{ $gradient := index $gradients (mod $index (len $gradients)) }}
          <a class="book-card" href="{{ .RelPermalink }}" {{ if not .Params.cover }}style="--cover-bg: {{ or .Params.coverColor $gradient }};"{{ end }}>
            {{ with .Params.cover }}
              <img class="book-card-cover" src="{{ . }}" alt="Cover of {{ $book.Title }}" loading="lazy" />
            {{ else }}
              <div class="book-card-cover placeholder" aria-label="Book cover"></div>
            {{ end }}
            <div class="book-card-info">
              <h3 class="book-title">{{ .Title }}</h3>
              {{ with .Params.author }}<p class="book-author">by {{ . }}</p>{{ end }}
            </div>
          </a>
        {{ end }}
      </div>
    </section>
  {{ else }}
    <article class="book-page">
      {{ partial "breadcrumbs.html" . }}
      
      <div class="book-hero">
        <div class="book-hero-content">
          <div class="book-cover-section">
            {{ with .Params.cover }}
              <img class="book-cover-image" src="{{ . }}" alt="Cover of {{ $.Title }}" />
            {{ else }}
              <div class="book-cover-placeholder" style="background: {{ or .Params.coverColor "linear-gradient(135deg, #667eea 0%, #764ba2 100%)" }};">
                <div class="book-spine"></div>
              </div>
            {{ end }}
          </div>
          
            <div class="book-info-section">
              <h1 class="book-main-title">{{ .Title }}</h1>
              
              <div class="book-meta-info">
                {{ with .Params.author }}
                <span class="meta-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                  {{ . }}
                </span>
              {{ end }}
              
              {{ with .Params.translator }}
                <span class="meta-item">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="5 8 10 13"></polyline>
                    <polyline points="14 8 19 13"></polyline>
                    <line x1="2" y1="2" x2="22" y2="22"></line>
                    <path d="M7 2h1a2 2 0 0 1 2 2v4.245a3 3 0 0 0 .879 2.121L12 11.5"></path>
                  </svg>
                  Adapted by {{ . }}
                </span>
              {{ end }}
              
              {{/* Status badge: prefer explicit param; otherwise infer from chapter count */}}
              {{ $explicit := .Params.status }}
              {{ $planned := .Params.plannedChapters }}
              {{ $count := len .Pages }}
              {{ if $explicit }}
                {{ if eq $explicit "in-progress" }}
                  <span class="status-badge in-progress">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    In Progress
                  </span>
                {{ else if eq $explicit "complete" }}
                  <span class="status-badge complete">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                      <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    Complete
                  </span>
                {{ end }}
              {{ else if $planned }}
                {{ if ge $count $planned }}
                  <span class="status-badge complete">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                      <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    Complete
                  </span>
                {{ else }}
                  <span class="status-badge in-progress">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    In Progress
                  </span>
                {{ end }}
              {{ end }}
              </div>
            
            {{ with .Params.description }}
              <p class="book-description">{{ . }}</p>
            {{ end }}
            
            {{ with .Content }}
              <div class="book-content">{{ . }}</div>
            {{ end }}
            
            {{ with .Params.plannedChapters }}
              {{ $count := len $.Pages }}
              <div class="progress-section">
                <div class="progress-label">Reading Progress</div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width: {{ mul (div (float $count) .) 100 }}%"></div>
                </div>
                <div class="progress-text">{{ $count }} of {{ . }} chapters available</div>
              </div>
            {{ end }}
            
            <div class="action-buttons">
              {{ if .Pages }}
                {{ $firstChapter := index .Pages.ByWeight 0 }}
                <a href="{{ $firstChapter.RelPermalink }}" class="btn-start-reading">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                  </svg>
                  Start Reading
                </a>
              {{ end }}
            </div>
          </div>
        </div>
      </div>
      
      {{ if or .Params.summary .Params.whyClassic }}
      <div class="book-details">
        {{ with .Params.summary }}
        <section class="detail-section">
          <h2 class="section-heading">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
              <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
            </svg>
            About This Book
          </h2>
          <div class="section-content">{{ . | markdownify }}</div>
        </section>
        {{ end }}
        
        {{ with .Params.whyClassic }}
        <section class="detail-section">
          <h2 class="section-heading">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
            </svg>
            Why It's a Classic
          </h2>
          <div class="section-content">{{ . | markdownify }}</div>
        </section>
        {{ end }}
      </div>
      {{ end }}
      
      <section class="chapters-section">
        <h2 class="chapters-heading">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            <line x1="12" y1="6" x2="16" y2="6"></line>
            <line x1="12" y1="10" x2="16" y2="10"></line>
          </svg>
          Chapters
        </h2>
        <ol class="chapter-list">
          {{ range .Pages.ByWeight }}
            <li class="chapter-item">
              <a href="{{ .RelPermalink }}" class="chapter-link">
                <span class="chapter-number">{{ .Params.chapter }}</span>
                <div class="chapter-info">
                  <span class="chapter-title">{{ .Title }}</span>
                  {{ with .Params.summary }}
                    <span class="chapter-summary">{{ . }}</span>
                  {{ end }}
                </div>
                <svg class="chapter-arrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
              </a>
            </li>
          {{ end }}
        </ol>
      </section>
    </article>
    
    <style>
      .book-page {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
      }
      
      .book-hero {
        background: white;
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
      }
      
      .book-hero-content {
        display: flex;
        gap: 2.5rem;
        align-items: start;
      }
      
      .book-cover-section {
        flex-shrink: 0;
      }
      
      .book-cover-image {
        width: 240px;
        height: 320px;
        object-fit: cover;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      }
      
      .book-cover-placeholder {
        width: 240px;
        height: 320px;
        border-radius: 12px;
        position: relative;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .book-spine {
        position: absolute;
        left: 20px;
        top: 10%;
        bottom: 10%;
        width: 4px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 2px;
      }
      
      .book-info-section {
        flex: 1;
      }
      
      .book-main-title {
        font-size: 2.5rem;
        font-weight: 800;
        margin: 0 0 1rem;
        color: #1a1611;
        line-height: 1.2;
      }
      
      .book-meta-info {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1.5rem;
      }
      
      .meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #666;
        font-size: 0.95rem;
      }
      
      .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 600;
      }
      
      .status-badge.in-progress {
        background: #fff3e0;
        color: #ff9944;
      }
      
      .status-badge.complete {
        background: #e8f5e9;
        color: #4caf50;
      }
      
      .book-description {
        font-size: 1.1rem;
        color: #444;
        line-height: 1.6;
        margin-bottom: 1.5rem;
      }
      
      .book-content {
        color: #666;
        line-height: 1.6;
        margin-bottom: 1.5rem;
      }
      
      .progress-section {
        margin-bottom: 2rem;
      }
      
      .progress-label {
        font-size: 0.85rem;
        font-weight: 600;
        color: #888;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 0.5rem;
      }
      
      .progress-bar {
        height: 8px;
        background: #f0f0f0;
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 0.5rem;
      }
      
      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #ff9944, #ff7722);
        border-radius: 4px;
        transition: width 0.3s ease;
      }
      
      .progress-text {
        font-size: 0.9rem;
        color: #666;
      }
      
      .action-buttons {
        display: flex;
        gap: 1rem;
      }
      
      .btn-start-reading {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.8rem 1.5rem;
        background: linear-gradient(135deg, #ff9944, #ff7722);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .btn-start-reading:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(255, 153, 68, 0.3);
      }
      
      .book-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
      }
      
      .detail-section {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
      }
      
      .section-heading {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.3rem;
        font-weight: 700;
        color: #1a1611;
        margin: 0 0 1rem;
      }
      
      .section-content {
        color: #666;
        line-height: 1.7;
      }
      
      .section-content p {
        margin: 0.5rem 0;
      }
      
      .chapters-section {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
      }
      
      .chapters-heading {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.3rem;
        font-weight: 700;
        color: #1a1611;
        margin: 0 0 1.5rem;
      }
      
      .chapter-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      
      .chapter-item {
        border-bottom: 1px solid #f0f0f0;
      }
      
      .chapter-item:last-child {
        border-bottom: none;
      }
      
      .chapter-link {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 0.5rem;
        text-decoration: none;
        color: inherit;
        transition: all 0.2s ease;
      }
      
      .chapter-link:hover {
        background: rgba(255, 153, 68, 0.05);
        padding-left: 1rem;
      }
      
      .chapter-number {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: #f8f8f8;
        border-radius: 50%;
        font-weight: 700;
        color: #ff9944;
        flex-shrink: 0;
      }
      
      .chapter-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }
      
      .chapter-title {
        font-weight: 600;
        color: #333;
      }
      
      .chapter-summary {
        font-size: 0.9rem;
        color: #888;
        font-style: italic;
      }
      
      .chapter-arrow {
        color: #ccc;
        flex-shrink: 0;
      }
      
      /* Dark mode styles */
      .dark-mode-active .book-hero {
        background: #2a2520;
      }
      
      .dark-mode-active .book-main-title {
        color: #ffd4a3;
      }
      
      .dark-mode-active .meta-item {
        color: #a89577;
      }
      
      .dark-mode-active .book-description {
        color: #c4a67d;
      }
      
      .dark-mode-active .book-content {
        color: #a89577;
      }
      
      .dark-mode-active .progress-label {
        color: #a89577;
      }
      
      .dark-mode-active .progress-bar {
        background: #332b25;
      }
      
      .dark-mode-active .progress-text {
        color: #a89577;
      }
      
      .dark-mode-active .detail-section {
        background: #2a2520;
      }
      
      .dark-mode-active .section-heading {
        color: #ffd4a3;
      }
      
      .dark-mode-active .section-content {
        color: #a89577;
      }
      
      .dark-mode-active .chapters-section {
        background: #2a2520;
      }
      
      .dark-mode-active .chapters-heading {
        color: #ffd4a3;
      }
      
      .dark-mode-active .chapter-item {
        border-bottom-color: rgba(255, 169, 77, 0.1);
      }
      
      .dark-mode-active .chapter-link:hover {
        background: rgba(255, 169, 77, 0.08);
      }
      
      .dark-mode-active .chapter-number {
        background: #332b25;
        color: #ffb366;
      }
      
      .dark-mode-active .chapter-title {
        color: #f0e0d0;
      }
      
      .dark-mode-active .chapter-summary {
        color: #8a7860;
      }
      
      .dark-mode-active .chapter-arrow {
        color: #4a433d;
      }
      
      .dark-mode-active .status-badge.in-progress {
        background: rgba(255, 153, 68, 0.15);
        color: #ffb366;
      }
      
      /* Mobile responsive */
      @media (max-width: 768px) {
        .book-hero-content {
          flex-direction: column;
          align-items: center;
          text-align: center;
        }
        
        .book-cover-image,
        .book-cover-placeholder {
          width: 200px;
          height: 267px;
        }
        
        .book-main-title {
          font-size: 1.8rem;
        }
        
        .book-meta-info {
          justify-content: center;
        }
        
        .book-details {
          grid-template-columns: 1fr;
        }
        
        .chapter-link {
          padding: 0.8rem 0;
        }
        
        .chapter-number {
          width: 32px;
          height: 32px;
          font-size: 0.85rem;
        }
      }
    </style>
  {{ end }}
{{ end }}
